::
:: Delete exploit protection settings
::
:: Iterates HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options
:: and confirms deletion for each entry
::

@echo off
setlocal enabledelayedexpansion

set actKey=


for /F "tokens=* delims= " %%H in ('reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options"') do (
    
    call :handleEntry "%%H"
    
    if !errorlevel! EQU 4 (
        call 
        goto loopEnd
    )
    
)
:loopEnd

endlocal
echo exiting with code %errorlevel%
exit /b %errorlevel%



:handleEntry
setlocal
    set "actKey=%~1"
    
    echo %actKey%
    
    :showChoices
    choice /C "CDIQ" /M "Continue (C), Delete entry (E), inspect entry (I) or quit iteration (Q)."
   
    if !errorlevel! == 1 (
        REM continue
        
        call 
    
    ) else if !errorlevel! == 2 (
        REM Delete entry
    
        reg delete "%actKey%"
    
    ) else if !errorlevel! == 3 (
        REM Inspect entry and re-offer choices
        
        reg query "%actKey%" /s
        
        goto showChoices
        
    ) else if !errorlevel! == 4 (
        REM quit iteration
    )

    echo.
    
    endlocal
    exit /b %errorlevel%
